
<% content_for :cover do %>

  <div class="view" id="edges-index">
    <% if @target_user %>
      <h1>
        <p><%= render 'follows/follow_form', user: @target_user %></p>
        <%= @target_user.name %>さんのマップ
        <% if current_user == @target_user %>
          <%# ログインユーザと一致 %>
          <% if @is_hide_user %>
            （非公開中）
          <% else %>
            （公開中）
          <% end %>
        <% end %>
      </h1>
    <% end %>
  </div>
  
  <div id="drawer">
    <div class="drawer-open">
      <span class="glyphicon glyphicon-triangle-left"></span>
    </div>
    <div class="drawer-body">
      <% if @is_debug_view %>
        <%= render 'edges/debug_index' %>
      <% end %>
      <div class="drawer-title page-head">
        <h4 class="page-head-title">単語一覧</h4>
      </div>
      <div class="drawer-content">
        <div class="panel-group" id="nodes-index" role="tablist" aria-multiselectable="true">
        </div>
      </div>
    </div>
  </div>

  <datalist id="node-words">
  </datalist>
  
  <div id="node-new" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal"><span>×</span></button>
          <h4 class="modal-title">新規作成</h4>
        </div>
        
        <div class="modal-body">
          <%= form_for(@from_node, method: :get, url: new_edge_path, html: {id: "node-new-form"}, remote: true) do |f| %>
            
            <div class="form-group node-circle text-center">
              <%= f.label :name, 'ノード名', class: 'sr-only' %>
              <%= f.text_field :name, class: 'form-control node-name', autocomplete: "on", list: "node-words", placeholder: "単語を入力", required: true %>
            </div>
          
            <div class="form-group text-center">
              <%= f.submit '次へ', class: 'btn btn-default', name: nil %>
            </div>
            
          <% end %>
        </div>
        
      </div>
    </div>
  </div>
  
  
  <div id="edge-new" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal"><span>×</span></button>
          <h4 class="modal-title">新規作成</h4>
        </div>
        
        <div class="modal-body">
          <%= form_for(@to_node, method: :post, url: edges_path, html: {id: "edge-new-form"}, remote: true) do |f| %>
            
            <%= hidden_field_tag :from_node_name, "" %>
            
            <div class="row">
              <div class="edge-line"></div>
              
              <div class="edge-form-node col-xs-4">
                <div class="text-center">
                  <div class="node-circle">
                    <span id="from-node-label" class="node-name"></span>
                  </div>
                </div>
              </div>
              
              <div class="edge-to-node col-xs-8 text-center">
                <div class="form-group node-circle">
                  <%= f.label :name, 'ノード名', class: 'sr-only' %>
                  <%= f.text_field :name, class: 'form-control node-name', autocomplete: "on", list: "node-words", placeholder: "連想する単語を入力", required: true %>
                </div>
              </div>
            </div>
            
            <div class="form-group text-center">
              <%= check_box_tag :is_hide_user %>
              <%= label_tag :is_hide_user, '自分の名前を非公開にする' %>
            </div>
            
            <div class="form-group text-center">
              <%= f.submit '作成', class: 'btn btn-default', name: nil %>
            </div>
            
          <% end %>
        </div>
        
      </div>
    </div>
  </div>
  
  
  <%# ポップアップ %>
  <div id="users-modal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true"></div>

<% end %>


<% content_for :script do %>

  <script>
    var imaginnection = imaginnection || {};
    imaginnection.current_id = "<%=j (user_signed_in?)? current_user.ref_id : '' %>";
    imaginnection.map_user_id = "<%=j (@target_user)? @target_user.ref_id : (user_signed_in?)? current_user.ref_id : '' %>";
    imaginnection.map_user_name = "<%=j (@target_user)? @target_user.name.html_safe : (user_signed_in?)? current_user.name.html_safe : '' %>";
    imaginnection.view_ids = <%= @view_ref_ids.to_json.html_safe %>;
  </script>
  
  <%= javascript_include_tag 'vendor/bootstrap-tour.min.js' %>
  
  <%= javascript_include_tag 'firebase/data.js' %>
  <% if ENV['BAAS_STAGING'] == 'true' %>
    <%= javascript_include_tag 'firebase/init-stg.js' %>
  <% else %>
    <%= javascript_include_tag 'firebase/init.js' %>
  <% end %>
  <%= javascript_include_tag 'firebase/view.js' %>
  <%= javascript_include_tag 'firebase/update.js' %>
  
  <%= javascript_include_tag 'common/tour.js' %>
  <%= javascript_include_tag 'vendor/three/three.min.js' %>
  <%= javascript_include_tag 'vendor/three/controls/TrackballControls.js' %>
  <%= javascript_include_tag 'vendor/three/renderers/CanvasRenderer.js' %>
  <%= javascript_include_tag 'vendor/three/renderers/Projector.js' %>
  <%= javascript_include_tag 'three/view.js' %>
  <%= javascript_include_tag 'three/events.js' %>
  <%= javascript_include_tag 'three/data.js' %>
  <%= javascript_include_tag 'three/update.js' %>
  <%= javascript_include_tag 'three/init.js' %>

  <%= javascript_include_tag 'firebase/events.js' %>
  
<% end %>
